<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FIT3179 - Water and Wealth in the MDB</title>
    
    <script src="https://cdn.jsdelivr.net/npm/vega@5.22.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5.6.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6.21.0"></script>
    
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

    <div class="container">
        <h1>The Lifeblood of a Nation</h1>
        <p style="text-align: center; font-size: 1.2rem; color: #495057;">Water and Wealth in the Murray-Darling Basin (2020)</p>
        <p>
            The Murray-Darling Basin (MDB) is the agricultural heartland of Australia, producing a significant portion of the nation's food and fibre. However, its water resources are limited and highly variable. This visualization explores the crucial relationship between where water naturally falls (Rainfall - the "Cause"), how this water is utilized by different farming industries (Water Use - the "Action"), and the resulting economic output (Agricultural Value - the "Effect"). Discover how different regions within the basin adapted to the conditions of 2020.
        </p>

        <h2>Explore the Data</h2>
        <p>
            The map below shows Australia's Murray-Darling Basin agricultural regions. <strong>White areas</strong> represent the MDB states where our data is focused, <strong>gray areas</strong> show other Australian states for geographic context, and the <strong>blue background</strong> represents the ocean. Each colored bubble on the map represents a catchment region. The <strong>colour</strong> of each bubble indicates the average annual rainfall received in 2020 (lighter blue = less rain, darker blue = more), representing the natural water 'income'. The <strong>size</strong> of each bubble represents the total economic value ($AUD million) generated from irrigated agriculture in that year, showing the economic 'output'. Notice that some of the largest bubbles (highest value) are in areas with lighter colours (lower rainfall). <strong>Click a bubble</strong> to investigate the details below.
        </p>
        
        <div class="vis-container">
            <div id="map_vis"></div>
            <button id="clear_selection_btn" class="clear-btn">Clear Selection</button>
        </div>

        <div class="vis-container">
            <div id="overview_vis"></div>
            <p>This scatter plot provides a basin-wide overview for 2020. Each point represents one MDB region. Its position shows the relationship between <strong>Rainfall</strong> (X-axis) and the <strong>Total Economic Value</strong> generated (Y-axis). The <strong>size</strong> of the point indicates the <strong>Total Water Use</strong> (ML) for that region. Observe the general pattern: are the most valuable regions always the wettest? Which regions use the most water? Click a bubble on the map above to see detailed breakdowns.</p>
        </div>
 
        <div class="vis-container vis-row">
            <div class="vis-card"><div id="water_vis"></div></div>
            <div>
                <h2>Water Use by Industry</h2>
                <p>Shows how irrigation water (ML) is distributed across major industries in the selected catchment in 2020. The longest bars represent the thirstiest sectors. Use this to compare water intensity across different agricultural activities. <strong>Click a bubble on the map above to populate this chart.</strong></p>
            </div>
        </div>

        <div class="vis-container vis-row">
            <div class="vis-card"><div id="value_vis"></div></div>
            <div>
                <h2>Economic Value by Industry</h2>
                <p>Displays the gross value of irrigated production ($AUD million) by industry for the selected catchment in 2020. The longest bars represent the most profitable sectors. Contrast this with water use to see efficiency and value creation. <strong>Click a bubble on the map above to populate this chart.</strong></p>
            </div>
        </div>

        <h2>Key Insights</h2>
        <p>
            Across the Murray-Darling Basin, agricultural success in 2020 wasn't simply about having the most rain. Regions like 'NSW Murrumbidgee' and 'VIC Goulburn-Broken', despite receiving moderate rainfall, generated substantial economic value. Clicking these regions reveals significant water use, particularly for high-value industries like cotton and horticulture, highlighting the pivotal role of irrigation and water management in converting water resources into national wealth. This delicate balance between water availability, usage choices, and economic return is central to the MDB's ongoing story.
        </p>

        <div class="footer">
            <p><strong>Author:</strong> Wong Yie Meng</p>
            <p><strong>Data Source:</strong> ABARES, Murray-Darling Basin water market catchment dataset 2021.</p>
        </div>
    </div>

    <script>
        console.log('Loading visualizations...');
        
        const mapSpec = "js/map_spec.json";
        const overviewSpec = "js/overview_spec.json";
        const waterSpec = "js/water_use_spec.json";
        const valueSpec = "js/value_spec.json";
        let overviewView, waterView, valueView;

        // Get clear button and initially disable it
        const clearBtn = document.getElementById('clear_selection_btn');
        clearBtn.disabled = true;

        // Embed the map
        vegaEmbed('#map_vis', mapSpec, {actions: false}).then(result => {
            const mapView = result.view;

            // Set up clear button click handler
            clearBtn.addEventListener('click', function() {
                // Clear the selection in the map
                mapView.signal('region_select_tuple', null).run();
                
                // Also clear in the child views
                overviewView.signal('selectedRegion', null).run();
                waterView.signal('selectedRegion', null).run();
                valueView.signal('selectedRegion', null).run();
            });

            // Embed overview, water, and value specs
            Promise.all([
              vegaEmbed('#overview_vis', overviewSpec, {actions: false}),
              vegaEmbed('#water_vis', waterSpec, {actions: false}),
              vegaEmbed('#value_vis', valueSpec, {actions: false})
            ]).then(([o, w, v]) => {
              overviewView = o.view; waterView = w.view; valueView = v.view;

              // Forward map selection to all three views
              mapView.addSignalListener('region_select_tuple', function(name, value) {
                let selectedRegion = null;
                if (value && value.values && value.values.length > 0) {
                  const fields = value.fields || [];
                  let regionIdx = -1;
                  for (let i = 0; i < fields.length; i++) {
                    const f = fields[i];
                    const fname = typeof f === 'object' ? f.field : f;
                    if (fname === 'Region') { regionIdx = i; break; }
                  }
                  const firstVal = value.values[0];
                  const regionVal = Array.isArray(firstVal) ? (regionIdx !== -1 ? firstVal[regionIdx] : firstVal[0]) : firstVal;
                  selectedRegion = (regionVal || '').toString().trim() || null;
                }
                
                // Enable/disable clear button based on selection
                clearBtn.disabled = !value || !value.values || value.values.length === 0;
                
                overviewView.signal('selectedRegion', selectedRegion).run();
                waterView.signal('selectedRegion', selectedRegion).run();
                valueView.signal('selectedRegion', selectedRegion).run();
              });
            }).catch(console.error);
        }).catch(console.error);
    </script>
</body>
</html>
