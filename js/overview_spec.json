{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "background": "transparent",
  "config": { "view": { "stroke": null } },
  "params": [ { "name": "selectedRegion", "value": null } ],
  "title": "Overview: Rainfall, Water Use & Value per MDB Region (2020)",
  "width": 1000,
  "height": 380,
  "data": { "url": "data/mdb_2020_data_with_coords.csv" },
  "transform": [
    {
      "aggregate": [
        { "op": "sum", "field": "Volume_applied", "as": "total_water_use_ML" },
        { "op": "sum", "field": "GVIAP_Millions", "as": "total_gviap_millions" },
        { "op": "mean", "field": "Rainfall", "as": "avg_rainfall" }
      ],
      "groupby": ["Region"]
    }
  ],
  "mark": { "type": "point", "filled": true },
  "encoding": {
    "x": { "field": "avg_rainfall", "type": "quantitative", "title": "Average Annual Rainfall (mm)" },
    "y": { "field": "total_gviap_millions", "type": "quantitative", "title": "Total Value ($AUD million)" },
    "size": { "field": "total_water_use_ML", "type": "quantitative", "title": "Total Water Use (ML)", "scale": { "range": [50, 2000] } },
    "color": { "value": "#888888" },
    "opacity": { "value": 0.9 },
    "stroke": {
      "condition": { "test": "selectedRegion != null && lower(trim(datum.Region)) == lower(trim(selectedRegion))", "value": "#1f2a44" },
      "value": "#cccccc"
    },
    "strokeWidth": {
      "condition": { "test": "selectedRegion != null && lower(trim(datum.Region)) == lower(trim(selectedRegion))", "value": 2 },
      "value": 0.5
    },
    "tooltip": [
      { "field": "Region", "type": "nominal", "title": "Region" },
      { "field": "avg_rainfall", "type": "quantitative", "title": "Rainfall (mm)", "format": ".0f" },
      { "field": "total_gviap_millions", "type": "quantitative", "title": "Value ($M)", "format": ".1f" },
      { "field": "total_water_use_ML", "type": "quantitative", "title": "Water Use (ML)", "format": ".0f" }
    ]
  }
}
