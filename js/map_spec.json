{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "background": "transparent",
  "config": {
    "legend": {
      "orient": "bottom",
      "direction": "horizontal",
      "titleFont": "Segoe UI",
      "labelFont": "Segoe UI"
    },
    "title": {
      "font": "Segoe UI",
      "fontSize": 20,
      "subtitleFontSize": 14,
      "anchor": "start"
    },
    "view": {"stroke": null}
  },
  "title": {
    "text": "Murray-Darling Basin Water Story",
    "subtitle": "Bubble Size = Economic Value ($AUD million), Color = Avg. Annual Rainfall (mm) for 2020"
  },
  "width": 850,
  "height": 600,
  "projection": {
    "type": "mercator",
    "center": [146, -34],
    "scale": 1200,
    "translate": [425, 350]
  },
  "data": {
    "url": "data/australian-states.json",
    "format": {
      "type": "json",
      "property": "features"
    }
  },
  "transform": [
    {
      "lookup": "properties.STATE_NAME",
      "from": {
        "data": {
          "values": [
            {"STATE_NAME": "New South Wales", "in_mdb": true},
            {"STATE_NAME": "Victoria", "in_mdb": true},
            {"STATE_NAME": "Queensland", "in_mdb": true},
            {"STATE_NAME": "South Australia", "in_mdb": true},
            {"STATE_NAME": "Australian Capital Territory", "in_mdb": true}
          ]
        },
        "key": "STATE_NAME",
        "fields": ["in_mdb"]
      }
    }
  ],
  "layer": [
    {
      "mark": {
        "type": "geoshape",
        "stroke": "#9aa6c1",
        "strokeWidth": 0.75
      },
      "encoding": {
        "color": {
          "condition": {
            "test": "datum.in_mdb == true",
            "value": "#eef3ff"
          },
          "value": "#f0f0f0"
        }
      }
    },
    {
      "data": {
        "url": "data/mdb_2020_data_with_coords.csv"
      },
      "transform": [
        {
          "aggregate": [
            {"op": "sum", "field": "Volume_applied", "as": "total_volume"},
            {"op": "sum", "field": "GVIAP_Millions", "as": "total_gviap"},
            {"op": "mean", "field": "Rainfall", "as": "avg_rainfall"}
          ],
          "groupby": ["Region", "Latitude", "Longitude"]
        }
      ],
      "mark": {
        "type": "circle",
        "cursor": "pointer"
      },
      "params": [
        {
          "name": "region_select",
          "select": {
            "type": "point",
            "fields": ["Region"],
            "on": "click",
            "clear": false
          }
        }
      ],
      "encoding": {
        "longitude": {"field": "Longitude", "type": "quantitative"},
        "latitude": {"field": "Latitude", "type": "quantitative"},
        "size": {
          "field": "total_gviap",
          "type": "quantitative",
          "title": "Value ($AUD million)",
          "scale": {"range": [50, 1000]},
          "legend": {"orient": "top-right", "titleFontSize": 12, "labelFontSize": 11}
        },
        "color": {
          "field": "avg_rainfall",
          "type": "quantitative",
          "title": "Avg. Annual Rainfall (mm)",
          "scale": {"scheme": "blues"},
          "legend": {"orient": "top-right", "offset": 40, "titleFontSize": 12, "labelFontSize": 11}
        },
        "opacity": {
          "condition": {
            "param": "region_select",
            "value": 1
          },
          "value": 0.6
        },
        "stroke": {
          "condition": {
            "param": "region_select",
            "value": "#1f2a44"
          },
          "value": "#9aa6c1"
        },
        "strokeWidth": {
          "condition": {
            "param": "region_select",
            "value": 2
          },
          "value": 0.5
        },
        "tooltip": [
          {"field": "Region", "type": "nominal", "title": "Catchment"},
          {
            "field": "avg_rainfall",
            "type": "quantitative",
            "format": ".0f",
            "title": "Rainfall (mm)"
          },
          {
            "field": "total_gviap",
            "type": "quantitative",
            "format": ".1f",
            "title": "Value ($AUD million)"
          }
        ]
      }
    }
  ]
}

